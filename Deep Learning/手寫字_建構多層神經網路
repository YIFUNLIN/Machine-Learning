{"cells":[{"cell_type":"markdown","metadata":{"id":"RfBBWWztflde"},"source":["# 8.5 範例：建構多層神經網路"]},{"cell_type":"code","execution_count":1,"metadata":{"executionInfo":{"elapsed":2828,"status":"ok","timestamp":1629439203376,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"bujepOtNfldk"},"outputs":[],"source":["from tensorflow.keras.datasets import mnist\n","from tensorflow.keras.models import Sequential\n","from tensorflow.keras.layers import Dense\n","from tensorflow.keras import optimizers\n","from tensorflow.keras.utils import plot_model\n","from tensorflow.keras.utils import to_categorical\n","import matplotlib.pyplot as plt\n","import numpy as np"]},{"cell_type":"markdown","metadata":{"id":"w-HaGUrOfldl"},"source":["#### 匯入資料集"]},{"cell_type":"code","execution_count":6,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":679,"status":"ok","timestamp":1629439285716,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"IPCU5Gdcfldl","outputId":"bc203697-08ac-41d1-f8e1-ed112d737e69"},"outputs":[{"name":"stdout","output_type":"stream","text":["Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz\n","11493376/11490434 [==============================] - 0s 0us/step\n","11501568/11490434 [==============================] - 0s 0us/step\n"]}],"source":["(X_train, y_train), (X_test, y_test) = mnist.load_data()"]},{"cell_type":"markdown","metadata":{"id":"2GEk9AXzfldm"},"source":["#### 資料預處理"]},{"cell_type":"code","execution_count":7,"metadata":{"executionInfo":{"elapsed":257,"status":"ok","timestamp":1629439287433,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"OHCWYUP6fldm"},"outputs":[],"source":["X_train = X_train.reshape(60000, 784).astype('float32')\n","X_test = X_test.reshape(10000, 784).astype('float32')"]},{"cell_type":"code","execution_count":8,"metadata":{"executionInfo":{"elapsed":5,"status":"ok","timestamp":1629439289015,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"FeTe0OiPfldm"},"outputs":[],"source":["X_train /= 255\n","X_test /= 255"]},{"cell_type":"code","execution_count":9,"metadata":{"executionInfo":{"elapsed":252,"status":"ok","timestamp":1629439290845,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"JW6UacHHfldn"},"outputs":[],"source":["n_classes = 10\n","y_train = to_categorical(y_train, n_classes)\n","y_test = to_categorical(y_test, n_classes)"]},{"cell_type":"markdown","metadata":{"id":"LFOUCtbpfldn"},"source":["#### 規劃神經網路結構"]},{"cell_type":"code","execution_count":10,"metadata":{"executionInfo":{"elapsed":4,"status":"ok","timestamp":1629439292050,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"z34K_ip2fldn"},"outputs":[],"source":["model = Sequential()\n","model.add(Dense(64, activation='relu', input_shape=(784,)))\n","model.add(Dense(64, activation='relu'))\n","model.add(Dense(10, activation='softmax'))"]},{"cell_type":"code","execution_count":11,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1629439293337,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"TSqdwYKSfldn","outputId":"4b391515-1ee2-4a4a-f6ab-fd4e013379ea"},"outputs":[{"name":"stdout","output_type":"stream","text":["Model: \"sequential_1\"\n","_________________________________________________________________\n","Layer (type)                 Output Shape              Param #   \n","=================================================================\n","dense_3 (Dense)              (None, 64)                50240     \n","_________________________________________________________________\n","dense_4 (Dense)              (None, 64)                4160      \n","_________________________________________________________________\n","dense_5 (Dense)              (None, 10)                650       \n","=================================================================\n","Total params: 55,050\n","Trainable params: 55,050\n","Non-trainable params: 0\n","_________________________________________________________________\n"]}],"source":["model.summary()"]},{"cell_type":"markdown","metadata":{"id":"vjEDJ6YKfldo"},"source":["#### 模型編譯"]},{"cell_type":"code","execution_count":12,"metadata":{"executionInfo":{"elapsed":270,"status":"ok","timestamp":1629439295616,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"CgvavKTFfldo"},"outputs":[],"source":["model.compile(loss='categorical_crossentropy',     #使用交叉熵損失函数\n","              optimizer=optimizers.SGD(learning_rate=0.01),    #將優化器設為SGD，學習率設0.01 \n","              metrics=['accuracy'])   #將模型預測準確率accuracy也納入模型效能指標"]},{"cell_type":"markdown","metadata":{"id":"bN2agfCbfldo"},"source":["#### 訓練神經網路!"]},{"cell_type":"code","execution_count":13,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":41836,"status":"ok","timestamp":1629439343450,"user":{"displayName":"Tristan Chang","photoUrl":"https://lh3.googleusercontent.com/a-/AOh14Gh12xA8ZXwa1dgzXFsLj_MwkqJdmxu_hK6DdwmvTQ=s64","userId":"01396821554749831700"},"user_tz":-480},"id":"SR4z0zDgfldo","outputId":"e117588b-388b-4ff8-da1d-ec5529468b39"},"outputs":[{"name":"stdout","output_type":"stream","text":["Epoch 1/20\n","469/469 [==============================] - 3s 4ms/step - loss: 1.3578 - accuracy: 0.6381 - val_loss: 0.6629 - val_accuracy: 0.8358\n","Epoch 2/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.5393 - accuracy: 0.8564 - val_loss: 0.4311 - val_accuracy: 0.8807\n","Epoch 3/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.4085 - accuracy: 0.8853 - val_loss: 0.3613 - val_accuracy: 0.8986\n","Epoch 4/20\n","469/469 [==============================] - 2s 3ms/step - loss: 0.3573 - accuracy: 0.8971 - val_loss: 0.3253 - val_accuracy: 0.9053\n","Epoch 5/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.3269 - accuracy: 0.9058 - val_loss: 0.3039 - val_accuracy: 0.9113\n","Epoch 6/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.3060 - accuracy: 0.9117 - val_loss: 0.2859 - val_accuracy: 0.9170\n","Epoch 7/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.2888 - accuracy: 0.9167 - val_loss: 0.2729 - val_accuracy: 0.9215\n","Epoch 8/20\n","469/469 [==============================] - 2s 3ms/step - loss: 0.2748 - accuracy: 0.9205 - val_loss: 0.2604 - val_accuracy: 0.9248\n","Epoch 9/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.2625 - accuracy: 0.9245 - val_loss: 0.2491 - val_accuracy: 0.9282\n","Epoch 10/20\n","469/469 [==============================] - 2s 3ms/step - loss: 0.2517 - accuracy: 0.9272 - val_loss: 0.2417 - val_accuracy: 0.9304\n","Epoch 11/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.2420 - accuracy: 0.9303 - val_loss: 0.2327 - val_accuracy: 0.9327\n","Epoch 12/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.2330 - accuracy: 0.9330 - val_loss: 0.2243 - val_accuracy: 0.9341\n","Epoch 13/20\n","469/469 [==============================] - 2s 3ms/step - loss: 0.2250 - accuracy: 0.9351 - val_loss: 0.2172 - val_accuracy: 0.9365\n","Epoch 14/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.2175 - accuracy: 0.9374 - val_loss: 0.2107 - val_accuracy: 0.9397\n","Epoch 15/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.2105 - accuracy: 0.9399 - val_loss: 0.2058 - val_accuracy: 0.9418\n","Epoch 16/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.2041 - accuracy: 0.9412 - val_loss: 0.1982 - val_accuracy: 0.9443\n","Epoch 17/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.1983 - accuracy: 0.9429 - val_loss: 0.1957 - val_accuracy: 0.9441\n","Epoch 18/20\n","469/469 [==============================] - 2s 3ms/step - loss: 0.1927 - accuracy: 0.9443 - val_loss: 0.1894 - val_accuracy: 0.9444\n","Epoch 19/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.1877 - accuracy: 0.9459 - val_loss: 0.1865 - val_accuracy: 0.9462\n","Epoch 20/20\n","469/469 [==============================] - 2s 4ms/step - loss: 0.1827 - accuracy: 0.9472 - val_loss: 0.1820 - val_accuracy: 0.9474\n"]},{"data":{"text/plain":["<keras.callbacks.History at 0x7f9f56e97f50>"]},"execution_count":13,"metadata":{},"output_type":"execute_result"}],"source":["model.fit(X_train, y_train, \n","            batch_size=128, epochs=20, \n","            verbose=1,\n","            validation_data=(X_test, y_test))\n","#註：由於神經網路的初始權重參數是隨機設定的, 參雜了隨機性, 因此底下 (或您重跑一次) 的結果會與書中有小差異"]},{"attachments":{},"cell_type":"markdown","metadata":{},"source":["- loss 為週期訓練的平均損失值(誤差)，藉由SGD愈降愈低\n","- accuracy 為訓練資料的預測準確率，若數值很高也要考慮是否overfitting\n","- val_loss 驗證資料的損失值，也有降下來\n","- val_accuracy 驗證資料的準確率，也有提高"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"_Ub6BvELfldp"},"outputs":[],"source":[]}],"metadata":{"colab":{"collapsed_sections":[],"name":"ch08-intermediate_net_in_keras.ipynb","provenance":[]},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.6.5"}},"nbformat":4,"nbformat_minor":0}
